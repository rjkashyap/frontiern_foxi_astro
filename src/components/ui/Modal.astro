---
// Modal
// ------------
// Description: Base modal with frosted full-screen overlay and scroll lock.
// Compatible with Foxi scripts (LocalScripts.astro).

import Button from './Button.astro'
import { Icon } from 'astro-icon/components'

type Props = {
	id?: string
	title?: string
	classes?: string
}
const { id, title, classes } = Astro.props
---

<div
  {...(id ? { id } : {})}
  class:list={[
    'modal',
    { [`${classes}`]: classes },
  ]}
>
  <div class="modal__overlay">
    <div class="modal__popup">
      <div class="modal__header">
        {title && <h2 class="modal__title">{title}</h2>}
        <Button size="sm" style="neutral" classes="modal__close" variation="link">
          <Icon name="x-mark" class="dark:text-neutral-50" />
          <span class="sr-only">Close</span>
        </Button>
      </div>
      <div class="modal__body">
        <slot />
      </div>
    </div>
  </div>
</div>

<style>
  /* ===== Overlay ===== */
  .modal {
    @apply fixed inset-0 z-50 hidden items-center justify-center bg-white/50 lg:backdrop-blur-sm dark:bg-neutral-900/50;
  }
  .modal.open {
    @apply flex;
  }

  /* Fullscreen overlay area */
  .modal__overlay {
    @apply fixed inset-0 flex items-center justify-center overflow-hidden;
  }

  /* ===== Popup (modal box) ===== */
  .modal__popup {
    @apply relative m-6 w-80 max-w-full sm:w-[90vw] md:w-[70vw] lg:w-[60vw] xl:w-[50vw]
    flex flex-col border border-neutral-100 bg-white dark:bg-neutral-900 dark:border-neutral-800
    text-neutral-500 shadow-xl shadow-neutral-700/10 dark:shadow-neutral-950/40
    rounded-none opacity-0 translate-y-6 transition-all duration-500
    [.open_&]:opacity-100 [.open_&]:translate-y-0;
  }

  .modal__header {
    @apply flex items-center justify-between gap-6 border-b border-neutral-100 dark:border-neutral-800 px-6 py-3 text-lg font-medium;
  }

  .modal__title {
    @apply mb-0 truncate text-lg text-neutral-900 dark:text-neutral-50;
  }

  .modal__body {
    @apply p-6 max-h-[80vh] overflow-y-auto;
  }

  .modal__close {
    @apply !rounded-full !px-2.5;
  }

  /* ===== Scroll Lock ===== */
  body.modal-open {
    overflow: hidden;
  }
</style>

<script is:inline>
  // Lock body scroll when modal opens/closes
  document.addEventListener('astro:page-load', () => {
    const modals = document.querySelectorAll('.modal');
    modals.forEach((modal) => {
      modal.addEventListener('transitionend', () => {
        if (modal.classList.contains('open')) {
          document.body.classList.add('modal-open');
        } else {
          document.body.classList.remove('modal-open');
        }
      });
    });
  });
</script>