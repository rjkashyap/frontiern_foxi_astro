---
/**
 * Feature Cards grid Section (with filters)
 * - Smooth fade + scale transition on filter change
 * - 3 cols Ã— 2 rows on large screens, stacks on small
 * - Equal-height cards
 * - Hard-coded filter toolbar (instant fade, gapless reflow)
 * - Neutral dark background + accent border for filters
 */

import Section from '../../ui/Section.astro'
import Row from '../../ui/Row.astro'
import Col from '../../ui/Col.astro'
import Card from '../../ui/cards/FeatureCard.astro'

import feature01 from '../../../assets/cards/feature-01.svg'
import feature02 from '../../../assets/cards/feature-02.svg'
import feature03 from '../../../assets/cards/feature-03.svg'
import feature04 from '../../../assets/cards/feature-04.svg'
import feature05 from '../../../assets/cards/feature-05.svg'

const items = [
  { title: 'All your data in one place', subtitle: 'Stay on top of your tasks and deadlines with our intuitive project management tool.', image: feature01, link: '/features', cat: 'staff-role' },
  { title: 'Organize & manage your projects', subtitle: 'Plan, assign, and track with clarity across teams and timelines.', image: feature02, link: '/features', cat: 'mission-internship' },
  { title: 'Keep your team connected', subtitle: 'Integrated chat to share updates, files, and messages securely.', image: feature03, link: '/features', cat: 'church-planting-residency' },
  { title: 'Manage your customers', subtitle: 'Build and nurture relationships with a powerful, simple CRM.', image: feature04, link: '/features', cat: 'short-term-trip' },
  { title: 'Simplify your financial operations', subtitle: 'Create, send, and track invoices effortlessly.', image: feature05, link: '/features', cat: 'medium-term-placement' },
  { title: 'Insights that drive action', subtitle: 'Dashboards and reports that surface what matters.', image: feature01, link: '/features', cat: 'long-term-placement' }
]

const filters = [
  { slug: 'all', label: 'All' },
  { slug: 'staff-role', label: 'Staff Role' },
  { slug: 'mission-internship', label: 'Mission Internship' },
  { slug: 'church-planting-residency', label: 'Church Planting Residency' },
  { slug: 'short-term-trip', label: 'Short-term Trip' },
  { slug: 'medium-term-placement', label: 'Medium-term Placement' },
  { slug: 'long-term-placement', label: 'Long-term Placement' }
]
---

<Section id="features">
  <Row>
    <Col span="12" align="center" classes="mb-8 max-w-4xl mx-auto">
      <h2 class="text-pretty">Innovative tools to <strong>transform</strong> your workflow</h2>
      <p class="pb-0 text-lg">
        Explore the suite of tools designed to streamline your workflow, enhance productivity, and
        drive growth. Each product is crafted with precision to meet your needs and exceed your
        expectations.
      </p>
    </Col>
  </Row>

  <Row>
    <Col span="12" align="center">
      <div id="feature-filters"
           class="inline-flex flex-wrap items-center justify-center gap-2 rounded border px-2 py-2
                  bg-neutral-900/60 border-neutral-800
                  dark:bg-neutral-900/60 dark:border-neutral-800">
        {filters.map((f, i) => (
          <button
            type="button"
            data-filter={f.slug}
            class:list={[
              'px-3 py-1.5 text-sm rounded border transition',
              'border-neutral-700 text-neutral-300 hover:bg-neutral-800 hover:border-neutral-600',
              i === 0 ? 'is-active bg-neutral-800 border-primary-500 text-neutral-100' : ''
            ]}>
            {f.label}
          </button>
        ))}
      </div>
    </Col>
  </Row>

  <div class="mt-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3" id="feature-grid">
    {items.map((it) => (
      <div class="flex h-[420px] sm:h-[380px] lg:h-[390px] w-full transition-opacity duration-150" data-cat={it.cat}>
        <div class="flex flex-col h-full w-full">
          <div class="h-full">
            <Card title={it.title} subtitle={it.subtitle} image={it.image} link={it.link} />
          </div>
        </div>
      </div>
    ))}
  </div>
</Section>

<style>
  /* Active filter button accent */
  #feature-filters .is-active {
    box-shadow: 0 0 0 1px theme('colors.primary.500 / 0.6');
  }

  /* =====================
     ANIMATIONS
     ===================== */
  #feature-grid > div {
    opacity: 1;
    transform: scale(1);
    transition:
      opacity 0.25s ease-in-out,
      transform 0.25s ease-in-out;
  }

  /* When hidden, fade out and scale down slightly */
  #feature-grid > div.is-hiding {
    opacity: 0;
    transform: scale(0.96);
  }

  /* When revealed, fade in smoothly */
  #feature-grid > div.is-showing {
    opacity: 0;
    transform: scale(1.04);
  }

  #feature-grid > div.is-showing.active {
    opacity: 1;
    transform: scale(1);
  }

  /* Smooth reflow */
  #feature-grid {
    transition: all 0.25s ease-in-out;
  }

  /* Tighter spacing */
  #feature-grid .card .card__body { padding-top: .25rem; padding-bottom: .25rem; }
  #feature-grid .card h3 { margin-bottom: .125rem; line-height: 1.2; }
  #feature-grid .card p  { margin-bottom: .125rem; line-height: 1.35; }

  /* Image container tweaks */
  #feature-grid .card { display: flex; flex-direction: column; }
  #feature-grid .card > picture { flex: 1 1 auto; padding: .5rem .5rem 0 .5rem; }
  #feature-grid .card > picture img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: .5rem;
    display: block;
  }

  /* Button area tighter */
  #feature-grid .card .cta-area {
    margin-top: .25rem;
    padding-top: .125rem;
    padding-bottom: .25rem;
  }
</style>

<script is:inline>
  document.addEventListener('astro:page-load', () => {
    const bar  = document.getElementById('feature-filters');
    const grid = document.getElementById('feature-grid');
    if (!bar || !grid) return;

    const btns  = Array.from(bar.querySelectorAll('[data-filter]'));
    const cards = Array.from(grid.children);

    const apply = (slug) => {
      cards.forEach((wrap) => {
        const cat = wrap.getAttribute('data-cat');
        const show = slug === 'all' || cat === slug;

        wrap.classList.remove('is-hiding', 'is-showing', 'active');

        if (show) {
          wrap.classList.add('is-showing');
          wrap.style.display = '';
          requestAnimationFrame(() => {
            wrap.classList.add('active');
          });
          setTimeout(() => wrap.classList.remove('is-showing'), 250);
        } else {
          wrap.classList.add('is-hiding');
          setTimeout(() => {
            wrap.style.display = 'none';
            wrap.classList.remove('is-hiding');
          }, 250);
        }
      });
    };

    const setActive = (target) => {
      btns.forEach(b =>
        b.classList.remove('is-active', 'bg-neutral-800', 'border-primary-500', 'text-neutral-100')
      );
      target.classList.add('is-active', 'bg-neutral-800', 'border-primary-500', 'text-neutral-100');
    };

    btns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        setActive(btn);
        apply(btn.getAttribute('data-filter'));
      });
    });

    apply('all');
  });
</script>