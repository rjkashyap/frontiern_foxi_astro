---
// Signup Modal (Repurposed as Contact Form)
// Keeps Foxi modal overlay, centering, animation.
// Adds disabled submit until required fields valid.

import Modal from '../../ui/Modal.astro'
import Form from '../../ui/forms/Form.astro'
import FormField from '../../ui/forms/partials/FormField.astro'
import InputField from '../../ui/forms/form-elements/InputField.astro'
import Button from '../../ui/Button.astro'

type Props = { classes?: string }
const { classes } = Astro.props
---

<Modal id="signup" classes={classes} title="Contact Us">
  <div class="mx-auto w-full max-w-xl">
    <p class="mb-6 text-base leading-relaxed">
      Tell us a bit about your enquiry and we'll get back to you.
    </p>

    <!-- 1) Give the form a stable id -->
    <Form id="contactForm">
      <FormField>
        <!-- Mark whichever fields you want as required -->
        <InputField type="text" id="firstName" label="First Name" required />
        <InputField type="text" id="lastName" label="Last Name" />
      </FormField>

      <FormField>
        <InputField type="email" id="email" label="Email" required />
      </FormField>

      <FormField>
        <InputField type="tel" id="phone" label="Phone Number" />
      </FormField>

      <div class="mt-6 text-center">
        <!-- 2) Start disabled; we’ll enable when valid -->
        <Button id="submitBtn" style="primary" type="submit" size="lg" disabled>
          Send Message
        </Button>
      </div>
    </Form>
  </div>
</Modal>

<style>
  /* Keep Foxi’s tidy spacing */
  .modal__body form { @apply space-y-4; }
  .modal__body h2 { @apply text-2xl mb-4; }
  .modal__body p { @apply text-neutral-600 dark:text-neutral-300; }

  /* Smooth popup motion (same feel as Foxi signup) */
  .modal__popup { @apply transition-transform duration-500 ease-out; }

  /* Optional: a subtle disabled state */
  #submitBtn:disabled { @apply opacity-50 pointer-events-none; }
</style>

<script is:inline>
  // 3) Toggle the submit button based on form validity
  document.addEventListener('astro:page-load', () => {
    const form = document.getElementById('contactForm');
    const btn  = document.getElementById('submitBtn');
    if (!form || !btn) return;

    const toggle = () => {
      const valid = form.checkValidity();
      btn.disabled = !valid;
      btn.setAttribute('aria-disabled', String(!valid));
    };

    // Run once, then on every change
    toggle();
    form.addEventListener('input', toggle);
    form.addEventListener('change', toggle);

    // Extra safety: prevent submit and show native messages if invalid
    form.addEventListener('submit', (e) => {
      if (!form.checkValidity()) {
        e.preventDefault();
        form.reportValidity();
      }
    });
  });
</script>