---
// Components
// - Layout
import Layout from '../layouts/Layout.astro'
// - UI
import Hero from '../components/blocks/hero/HomeCTA.astro'

import TripsSection from '../components/blocks/trips/TripsSection.astro'
// import Testimonial from '../components/blocks/testimonials/BasicDark.astro'
// import HighlightBlocks from '../components/blocks/highlights/HightlightRows.astro'
// import CTA from '../components/blocks/CTA/BasicDark.astro'

// Baserow public JSON (rows) for your SiteContent view
const BASEROW_VIEW =
  'https://api.baserow.io/api/database/views/grid/2Rygf6nl75LDEqc2FtBZ-L4W3uUpreJ3BtiMSVjRtro/public/rows/?user_field_names=true'

let heroUrl: string | undefined = undefined
let heroAlt: string = 'Hero'

try {
  const res = await fetch(BASEROW_VIEW)
  if (res.ok) {
    const data = await res.json()
    const rows = Array.isArray(data?.results) ? data.results : []

    // Your field IDs from the JSON:
    // field_5880894 = Key, field_5881992 = HeroImage, field_5881993 = HeroAlt, field_5881994 = Published
    const heroRow =
      rows.find((r: any) => r?.field_5880894 === 'hero' && r?.field_5881994 === true) ||
      rows[0] ||
      null

    if (heroRow) {
      const img = heroRow?.field_5881992?.[0] // first attachment object
      // Prefer the original file URL; fall back to a reasonable thumbnail if missing
      const original = img?.url as string | undefined
      const thumb =
        img?.thumbnails?.card_cover?.url ??
        img?.thumbnails?.small?.url ??
        img?.thumbnails?.tiny?.url

      heroUrl = (original || thumb) ?? undefined
      heroAlt = (heroRow?.field_5881993 as string | undefined) || 'Hero'
    }
  }
} catch (err) {
  console.error('Error fetching Baserow hero:', err)
}

// - SEO
const SEO = {
  title: 'Frontier Nations | Mission, Discipleship & Church Multiplication',
  description:
    'Foxi is a powerful productivity toolkit designed to enhance your workflow and boost your productivity. With features like analytics, security, and integrations, Foxi is the perfect solution for your business.'
}
---
<Layout title={SEO.title} description={SEO.description}>
  <Hero heroUrl={heroUrl} heroAlt={heroAlt} />
  <TripsSection />

  {/* <Testimonial bg={testimonialBackground} bgPosition="right" /> */}
  {/* <HighlightBlocks /> */}
  {/* <CTA /> */}
</Layout>